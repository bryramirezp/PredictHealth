<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Redis Cache | PredictHealth</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/docs.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">
                <i class="fas fa-heartbeat"></i>
                PredictHealth Docs
            </a>
            <a href="/docs" class="back-btn">
                <i class="fas fa-arrow-left"></i> Volver
            </a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="docs-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Introducci贸n</div>
                <ul class="sidebar-links">
                    <li><a href="/docs" class="sidebar-link">Visi贸n General</a></li>
                    <li><a href="/docs/arquitectura" class="sidebar-link">Arquitectura del Sistema</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Backend</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/backend/flask" class="sidebar-link">Flask API</a></li>
                    <li><a href="/docs/backend/microservicios" class="sidebar-link">Microservicios</a></li>
                    <li><a href="/docs/backend/autenticacion" class="sidebar-link">Autenticaci贸n JWT</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Frontend</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/frontend/estructura" class="sidebar-link">Estructura</a></li>
                    <li><a href="/docs/frontend/componentes" class="sidebar-link">Componentes</a></li>
                    <li><a href="/docs/frontend/estilos" class="sidebar-link">Estilos y Dise帽o</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Base de Datos</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/database/postgresql" class="sidebar-link">PostgreSQL</a></li>
                    <li><a href="/docs/database/redis" class="sidebar-link active">Redis Cache</a></li>
                    <li><a href="/docs/database/firebase" class="sidebar-link">Firebase</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Machine Learning</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/ml/modelos" class="sidebar-link">Modelos Predictivos</a></li>
                    <li><a href="/docs/ml/entrenamiento" class="sidebar-link">Entrenamiento</a></li>
                    <li><a href="/docs/ml/deployment" class="sidebar-link">Despliegue</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Dispositivos</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/devices/mobile" class="sidebar-link">App M贸vil</a></li>
                    <li><a href="/docs/devices/leap-motion" class="sidebar-link">Leap Motion</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Deployment</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/deploy/docker" class="sidebar-link">Docker</a></li>
                    <li><a href="/docs/deploy/produccion" class="sidebar-link">Producci贸n</a></li>
                </ul>
            </div>
        </aside>

        <!-- Content -->
        <main class="content">
            <h1 class="page-title">
                <span class="emoji"></span>
                Redis Cache
            </h1>

            <p class="intro-text">
                Redis Alpine-based para almacenamiento de tokens JWT, gesti贸n de sesiones y capa de cach茅 de alto rendimiento. Proporciona acceso r谩pido a datos temporales y validaci贸n de autenticaci贸n.
            </p>

            <h2>Configuraci贸n</h2>
            <div>
                <span class="badge">Alpine-based Redis</span>
                <span class="badge">Puerto: 6379</span>
                <span class="badge">Memoria m谩xima: 1GB</span>
                <span class="badge">Pol铆tica: allkeys-lru</span>
                <span class="badge">AOF habilitado</span>
            </div>

            <h2>Uso en PredictHealth</h2>
            <p>
                Redis se utiliza para tres prop贸sitos principales:
            </p>

            <div class="tech-grid">
                <div class="tech-card">
                    <h4><i class="fas fa-key" style="color: #4dd9d6;"></i> Almacenamiento de Tokens JWT</h4>
                    <p>Tokens almacenados con formato <code>access_token:{jwt_token}</code> y TTL de 15 minutos.</p>
                </div>

                <div class="tech-card">
                    <h4><i class="fas fa-user-clock" style="color: #667eea;"></i> Gesti贸n de Sesiones</h4>
                    <p>Validaci贸n r谩pida de sesiones activas y renovaci贸n autom谩tica de tokens en uso.</p>
                </div>

                <div class="tech-card">
                    <h4><i class="fas fa-bolt" style="color: #f59e0b;"></i> Cach茅 Temporal</h4>
                    <p>Capa de cach茅 para datos frecuentemente accedidos y operaciones costosas.</p>
                </div>
            </div>

            <h2>Configuraci贸n Redis</h2>
            <p>
                Archivo <code>database/redis/redis.conf</code>:
            </p>

            <div class="tech-section">
                <h3>Par谩metros Principales</h3>
                <ul>
                    <li><strong>Puerto:</strong> 6379</li>
                    <li><strong>Memoria m谩xima:</strong> 1GB</li>
                    <li><strong>Pol铆tica de evicci贸n:</strong> <code>allkeys-lru</code> (Least Recently Used)</li>
                    <li><strong>Persistencia:</strong> AOF habilitado con fsync <code>everysec</code></li>
                    <li><strong>Puntos de guardado:</strong> 900s (1 cambio), 300s (10 cambios), 60s (10000 cambios)</li>
                    <li><strong>TCP keepalive:</strong> 300</li>
                    <li><strong>Timeout:</strong> 300</li>
                </ul>

                <h3>Pol铆tica de Evicci贸n LRU</h3>
                <p>
                    Cuando se alcanza el l铆mite de memoria (1GB), Redis elimina autom谩ticamente las claves menos usadas recientemente. Esto previene agotamiento de memoria y mantiene rendimiento 贸ptimo.
                </p>

                <h3>Persistencia AOF</h3>
                <p>
                    Append-Only File (AOF) habilitado con fsync cada segundo garantiza durabilidad de datos cr铆ticos (tokens JWT) mientras mantiene buen rendimiento.
                </p>
            </div>

            <h2>Integraci贸n con Servicios</h2>
            <p>
                Todos los microservicios y el API Gateway se conectan a Redis:
            </p>

            <div class="tech-section">
                <h3>Servicios que Utilizan Redis</h3>
                <ul>
                    <li><strong>auth-jwt-service:</strong> Almacenamiento y validaci贸n de tokens JWT</li>
                    <li><strong>backend-flask:</strong> Validaci贸n de sesiones mediante middleware JWT</li>
                    <li><strong>Microservicios:</strong> Cach茅 temporal y validaci贸n de tokens inter-servicios</li>
                </ul>

                <h3>Formato de Almacenamiento</h3>
                <pre><code># Tokens JWT
access_token:{jwt_token} = "{jwt_token_string}"
TTL: 900 segundos (15 minutos)

# Ejemplo de key
access_token:eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</code></pre>
            </div>

            <h2>Gesti贸n de Memoria</h2>
            <div class="tech-section">
                <h3>L铆mite de Memoria</h3>
                <p>
                    L铆mite configurado de 1GB previene agotamiento de memoria del sistema. Cuando se alcanza, la pol铆tica LRU elimina autom谩ticamente claves menos usadas.
                </p>

                <h3>Optimizaci贸n</h3>
                <ul>
                    <li>TTL autom谩tico en tokens JWT (15 minutos)</li>
                    <li>Pol铆tica LRU para gesti贸n eficiente de memoria</li>
                    <li>Persistencia AOF para durabilidad sin impacto significativo en rendimiento</li>
                </ul>
            </div>

            <h2>Health Checks</h2>
            <p>
                Redis incluye health check configurado en Docker Compose:
            </p>

            <div class="tech-section">
                <h3>Verificaci贸n de Salud</h3>
                <pre><code>healthcheck:
  test: ["CMD", "redis-cli", "ping"]
  interval: 10s
  timeout: 5s
  retries: 5</code></pre>

                <p>
                    El health check verifica conectividad mediante comando <code>PING</code>. Si Redis no responde, Docker marca el contenedor como no saludable.
                </p>
            </div>

            <h2>Operaciones Comunes</h2>
            <div class="tech-section">
                <h3>Acceso desde Contenedor</h3>
                <pre><code># Desde el host (si redis-cli est谩 instalado)
redis-cli -h localhost -p 6379

# Desde el contenedor
docker exec -it predicthealth-redis redis-cli

# Verificar tokens almacenados
KEYS access_token:*

# Obtener valor de token
GET access_token:{jwt_token}</code></pre>
            </div>

            <p class="footer-note">
                <i class="fas fa-info-circle"></i>
                Redis proporciona validaci贸n r谩pida de tokens JWT y gesti贸n eficiente de sesiones, esencial para el rendimiento del sistema de autenticaci贸n.
            </p>
        </main>
    </div>
</body>
</html>