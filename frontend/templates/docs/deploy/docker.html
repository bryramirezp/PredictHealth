<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Docker | PredictHealth</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/docs.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">
                <i class="fas fa-heartbeat"></i>
                PredictHealth Docs
            </a>
            <a href="/docs" class="back-btn">
                <i class="fas fa-arrow-left"></i> Volver
            </a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="docs-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Introducci贸n</div>
                <ul class="sidebar-links">
                    <li><a href="/docs" class="sidebar-link">Visi贸n General</a></li>
                    <li><a href="/docs/arquitectura" class="sidebar-link">Arquitectura del Sistema</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Backend</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/backend/flask" class="sidebar-link">Flask API</a></li>
                    <li><a href="/docs/backend/microservicios" class="sidebar-link">Microservicios</a></li>
                    <li><a href="/docs/backend/autenticacion" class="sidebar-link">Autenticaci贸n JWT</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Frontend</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/frontend/estructura" class="sidebar-link">Estructura</a></li>
                    <li><a href="/docs/frontend/componentes" class="sidebar-link">Componentes</a></li>
                    <li><a href="/docs/frontend/estilos" class="sidebar-link">Estilos y Dise帽o</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Base de Datos</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/database/postgresql" class="sidebar-link">PostgreSQL</a></li>
                    <li><a href="/docs/database/redis" class="sidebar-link">Redis Cache</a></li>
                    <li><a href="/docs/database/firebase" class="sidebar-link">Firebase</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Machine Learning</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/ml/modelos" class="sidebar-link">Modelos Predictivos</a></li>
                    <li><a href="/docs/ml/entrenamiento" class="sidebar-link">Entrenamiento</a></li>
                    <li><a href="/docs/ml/deployment" class="sidebar-link">Despliegue</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Dispositivos</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/devices/mobile" class="sidebar-link">App M贸vil</a></li>
                    <li><a href="/docs/devices/leap-motion" class="sidebar-link">Leap Motion</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Deployment</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/deploy/docker" class="sidebar-link active">Docker</a></li>
                    <li><a href="/docs/deploy/produccion" class="sidebar-link">Producci贸n</a></li>
                </ul>
            </div>
        </aside>

        <!-- Content -->
        <main class="content">
            <h1 class="page-title">
                <span class="emoji"></span>
                Docker
            </h1>

            <p class="intro-text">
                Containerizaci贸n completa de la plataforma PredictHealth mediante Docker Compose. Todos los servicios est谩n empaquetados en contenedores Docker con health checks, vol煤menes persistentes y configuraci贸n de red.
            </p>

            <h2>Docker Compose</h2>
            <p>
                El archivo <code>docker-compose.yml</code> define todos los servicios de la plataforma:
            </p>

            <div class="tech-grid">
                <div class="tech-card">
                    <h4><i class="fas fa-database" style="color: #4dd9d6;"></i> PostgreSQL</h4>
                    <p>Base de datos principal con inicializaci贸n autom谩tica mediante init.sql.</p>
                </div>

                <div class="tech-card">
                    <h4><i class="fas fa-bolt" style="color: #667eea;"></i> Redis</h4>
                    <p>Cach茅 y almacenamiento de sesiones con persistencia AOF.</p>
                </div>

                <div class="tech-card">
                    <h4><i class="fas fa-server" style="color: #f59e0b;"></i> Backend Flask</h4>
                    <p>API Gateway y web server en puerto 5000.</p>
                </div>

                <div class="tech-card">
                    <h4><i class="fas fa-shield-alt" style="color: #8b5cf6;"></i> CMS Backend</h4>
                    <p>Panel administrativo en puerto 5001.</p>
                </div>

                <div class="tech-card">
                    <h4><i class="fas fa-cogs" style="color: #10b981;"></i> Microservicios</h4>
                    <p>Auth-JWT (8003), Doctors (8000), Patients (8004), Institutions (8002).</p>
                </div>
            </div>

            <h2>Configuraci贸n de Servicios</h2>
            <div class="tech-section">
                <h3>Red Docker</h3>
                <p>
                    Todos los servicios se comunican mediante la red <code>predicthealth-network</code> (bridge, subnet: 172.20.0.0/16).
                </p>

                <h3>Vol煤menes Persistentes</h3>
                <ul>
                    <li><code>postgres_data</code> - Datos persistentes de PostgreSQL</li>
                    <li><code>redis_data</code> - Datos persistentes de Redis</li>
                </ul>

                <h3>Health Checks</h3>
                <p>
                    Todos los servicios incluyen health checks configurados:
                </p>
                <ul>
                    <li>PostgreSQL: <code>pg_isready</code> cada 30s</li>
                    <li>Redis: <code>redis-cli ping</code> cada 30s</li>
                    <li>Servicios de aplicaci贸n: endpoints <code>/health</code></li>
                </ul>
            </div>

            <h2>Dockerfiles</h2>
            <p>
                Cada servicio tiene su propio Dockerfile optimizado:
            </p>

            <div class="tech-section">
                <h3>Caracter铆sticas Comunes</h3>
                <ul>
                    <li>Multi-stage builds para im谩genes de producci贸n optimizadas</li>
                    <li>Ejecuci贸n con usuario no root para seguridad</li>
                    <li>Health checks integrados</li>
                    <li>Dependencias m铆nimas de runtime</li>
                </ul>

                <h3>Estructura de Dockerfiles</h3>
                <ul>
                    <li><code>backend-flask/Dockerfile</code> - Python 3.11, Flask, copia de frontend</li>
                    <li><code>cms-backend/Dockerfile</code> - Python 3.11, Flask, cliente PostgreSQL</li>
                    <li><code>microservices/*/Dockerfile</code> - Python 3.11, FastAPI</li>
                    <li><code>database/postgresql/Dockerfile</code> - PostgreSQL 15 con extensiones</li>
                    <li><code>database/redis/Dockerfile</code> - Redis Alpine-based</li>
                </ul>
            </div>

            <h2>Inicializaci贸n</h2>
            <p>
                Comandos para construir y ejecutar la plataforma:
            </p>

            <div class="tech-section">
                <h3>Construcci贸n y Ejecuci贸n</h3>
                <pre><code># Construir y levantar todos los servicios
docker-compose up --build

# Ejecutar en segundo plano
docker-compose up -d

# Ver logs de un servicio espec铆fico
docker-compose logs backend-flask
docker-compose logs servicio-doctores

# Verificar estado de contenedores
docker-compose ps</code></pre>

                <h3>Poblaci贸n de Base de Datos</h3>
                <pre><code># Poblar con datos de prueba
Get-Content populate.sql | docker exec -i predicthealth-postgres psql -U predictHealth_user -d predicthealth_db</code></pre>
            </div>

            <h2>Puertos Expuestos</h2>
            <div>
                <span class="badge">5000 - Frontend/API Gateway</span>
                <span class="badge">5001 - CMS Backend</span>
                <span class="badge">8000 - Doctors Service</span>
                <span class="badge">8002 - Institutions Service</span>
                <span class="badge">8003 - Auth JWT Service</span>
                <span class="badge">8004 - Patients Service</span>
                <span class="badge">5432 - PostgreSQL</span>
                <span class="badge">6379 - Redis</span>
            </div>

            <h2>Dependencias entre Servicios</h2>
            <p>
                Los servicios se inician en orden seg煤n dependencias:
            </p>

            <div class="tech-section">
                <h3>Orden de Inicio</h3>
                <ol>
                    <li>PostgreSQL y Redis (infraestructura)</li>
                    <li>Auth-JWT Service (autenticaci贸n)</li>
                    <li>Microservicios de dominio (doctors, patients, institutions)</li>
                    <li>Backend Flask y CMS Backend (aplicaciones)</li>
                </ol>

                <h3>Health Checks y Dependencias</h3>
                <p>
                    Los servicios esperan que sus dependencias pasen health checks antes de iniciar completamente.
                </p>
            </div>

            <p class="footer-note">
                <i class="fas fa-info-circle"></i>
                Docker Compose proporciona orquestaci贸n completa de la plataforma, facilitando desarrollo local y despliegue consistente.
            </p>
        </main>
    </div>
</body>
</html>