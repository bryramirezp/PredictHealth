<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Arquitectura del Sistema | PredictHealth</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/docs.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">
                <i class="fas fa-heartbeat"></i>
                PredictHealth Docs
            </a>
            <a href="/docs" class="back-btn">
                <i class="fas fa-arrow-left"></i> Volver
            </a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="docs-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Introducci√≥n</div>
                <ul class="sidebar-links">
                    <li><a href="/docs" class="sidebar-link">Visi√≥n General</a></li>
                    <li><a href="/docs/arquitectura" class="sidebar-link active">Arquitectura del Sistema</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Backend</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/backend/flask" class="sidebar-link">Flask API</a></li>
                    <li><a href="/docs/backend/microservicios" class="sidebar-link">Microservicios</a></li>
                    <li><a href="/docs/backend/autenticacion" class="sidebar-link">Autenticaci√≥n JWT</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Frontend</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/frontend/estructura" class="sidebar-link">Estructura</a></li>
                    <li><a href="/docs/frontend/componentes" class="sidebar-link">Componentes</a></li>
                    <li><a href="/docs/frontend/estilos" class="sidebar-link">Estilos y Dise√±o</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Base de Datos</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/database/postgresql" class="sidebar-link">PostgreSQL</a></li>
                    <li><a href="/docs/database/redis" class="sidebar-link">Redis Cache</a></li>
                    <li><a href="/docs/database/firebase" class="sidebar-link">Firebase</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Machine Learning</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/ml/modelos" class="sidebar-link">Modelos Predictivos</a></li>
                    <li><a href="/docs/ml/entrenamiento" class="sidebar-link">Entrenamiento</a></li>
                    <li><a href="/docs/ml/deployment" class="sidebar-link">Despliegue</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Dispositivos</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/devices/mobile" class="sidebar-link">App M√≥vil</a></li>
                    <li><a href="/docs/devices/leap-motion" class="sidebar-link">Leap Motion</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Deployment</div>
                <ul class="sidebar-links">
                    <li><a href="/docs/deploy/docker" class="sidebar-link">Docker</a></li>
                    <li><a href="/docs/deploy/produccion" class="sidebar-link">Producci√≥n</a></li>
                </ul>
            </div>
        </aside>

        <!-- Content -->
        <main class="content">
            <h1 class="page-title">
                <span class="emoji">üèóÔ∏è</span>
                Arquitectura del Sistema
            </h1>

            <p class="intro-text">
                PredictHealth implementa una arquitectura de microservicios escalable y modular, dise√±ada para alta disponibilidad y rendimiento. El sistema separa responsabilidades en capas especializadas que se comunican mediante APIs REST.
            </p>

            <h2>Componentes Principales</h2>
            <p>
                La arquitectura se compone de cuatro capas principales: presentaci√≥n, API Gateway, servicios de dominio y persistencia.
            </p>

            <div class="tech-grid">
                <div class="tech-card">
                    <h4><i class="fas fa-desktop" style="color: #4dd9d6;"></i> Frontend Web</h4>
                    <p>HTML5/CSS3/JavaScript con Bootstrap 5.3 y templates Jinja2. Interfaz multi-usuario con dashboards por rol.</p>
                </div>

                <div class="tech-card">
                    <h4><i class="fas fa-server" style="color: #667eea;"></i> API Gateway</h4>
                    <p>Flask 2.3.3 como punto de entrada √∫nico. Enrutamiento, proxy a microservicios, middleware JWT y web server.</p>
                </div>

                <div class="tech-card">
                    <h4><i class="fas fa-cogs" style="color: #f59e0b;"></i> Microservicios</h4>
                    <p>FastAPI 0.104.1 para servicios especializados: autenticaci√≥n, doctores, pacientes e instituciones.</p>
                </div>

                <div class="tech-card">
                    <h4><i class="fas fa-database" style="color: #8b5cf6;"></i> Base de Datos</h4>
                    <p>PostgreSQL 15 con esquema normalizado 3NF, procedimientos almacenados y vistas materializadas.</p>
                </div>

                <div class="tech-card">
                    <h4><i class="fas fa-bolt" style="color: #10b981;"></i> Redis Cache</h4>
                    <p>Almacenamiento de tokens JWT, gesti√≥n de sesiones y capa de cach√© para alto rendimiento.</p>
                </div>

                <div class="tech-card">
                    <h4><i class="fas fa-shield-alt" style="color: #ef4444;"></i> CMS Backend</h4>
                    <p>Panel administrativo Flask con control de acceso basado en roles para gesti√≥n de entidades.</p>
                </div>
            </div>

            <h2>Servicios y Puertos</h2>
            <p>
                Cada componente expone servicios en puertos espec√≠ficos dentro de la red Docker:
            </p>

            <div class="tech-section">
                <h3>Servicios de Aplicaci√≥n</h3>
                <ul>
                    <li><strong>Frontend/API Gateway</strong> (5000): Interfaz web y punto de entrada √∫nico</li>
                    <li><strong>CMS Backend</strong> (5001): Panel administrativo con control de acceso basado en roles</li>
                    <li><strong>Auth JWT Service</strong> (8003): Autenticaci√≥n y gesti√≥n de tokens JWT</li>
                    <li><strong>Doctors Service</strong> (8000): Gesti√≥n de perfiles de doctores y especialidades</li>
                    <li><strong>Patients Service</strong> (8004): Gesti√≥n de pacientes y perfiles de salud</li>
                    <li><strong>Institutions Service</strong> (8002): Gesti√≥n de instituciones m√©dicas</li>
                </ul>

                <h3>Servicios de Infraestructura</h3>
                <ul>
                    <li><strong>PostgreSQL</strong> (5432): Base de datos principal con esquema normalizado</li>
                    <li><strong>Redis</strong> (6379): Cach√© y almacenamiento de sesiones</li>
                </ul>
            </div>

            <h2>Flujo de Datos</h2>
            <p>
                El flujo de datos sigue un patr√≥n de tres capas con separaci√≥n clara de responsabilidades:
            </p>

            <ol>
                <li><strong>Capa de Presentaci√≥n:</strong> Frontend web renderiza templates Jinja2 y maneja interacciones de usuario</li>
                <li><strong>Capa de L√≥gica de Negocio:</strong> API Gateway enruta requests a microservicios especializados con validaci√≥n JWT</li>
                <li><strong>Capa de Datos:</strong> PostgreSQL para persistencia, Redis para cach√© y sesiones</li>
            </ol>

            <h2>Patr√≥n API Gateway</h2>
            <p>
                El Backend Flask act√∫a como API Gateway √∫nico, proporcionando:
            </p>

            <div class="tech-section">
                <h3>Enrutamiento Inteligente</h3>
                <p>
                    Proxy autom√°tico a microservicios seg√∫n patrones de URL. Requests a <code>/api/v1/doctors/*</code> se enrutan al servicio de doctores, <code>/api/v1/patients/*</code> al servicio de pacientes.
                </p>

                <h3>Inyecci√≥n de JWT</h3>
                <p>
                    Tokens Bearer se inyectan autom√°ticamente en headers de requests a microservicios. El token se obtiene de cookies HTTP-only o del contexto de la aplicaci√≥n.
                </p>

                <h3>Retry Logic</h3>
                <p>
                    Reintentos autom√°ticos con backoff exponencial: 3 intentos con delay base de 1 segundo. Timeouts configurables (10s default).
                </p>

                <h3>Middleware JWT</h3>
                <p>
                    Validaci√≥n de sesiones contra Redis en cada request protegido. Tokens almacenados con formato <code>access_token:{jwt_token}</code> y TTL de 15 minutos.
                </p>
            </div>

            <h2>Comunicaci√≥n entre Servicios</h2>
            <p>
                Los microservicios se comunican mediante APIs REST sobre HTTP. El API Gateway maneja el enrutamiento y la inyecci√≥n de autenticaci√≥n.
            </p>

            <div class="tech-section">
                <h3>Autenticaci√≥n Inter-Servicios</h3>
                <p>
                    El servicio de autenticaci√≥n (auth-jwt-service) proporciona tokens JWT que otros servicios validan. Los tokens contienen <code>reference_id</code> para acceso a entidades de dominio.
                </p>

                <h3>Base de Datos Compartida</h3>
                <p>
                    Todos los microservicios se conectan a la misma instancia PostgreSQL con esquema normalizado. Cada servicio gestiona sus tablas de dominio espec√≠ficas.
                </p>

                <h3>Redis Compartido</h3>
                <p>
                    Redis se utiliza para almacenamiento de tokens JWT, gesti√≥n de sesiones y cach√© temporal. Pol√≠tica de evicci√≥n LRU con l√≠mite de 1GB.
                </p>
            </div>

            <h2>Stack Tecnol√≥gico</h2>
            <div>
                <span class="badge">Flask 2.3.3</span>
                <span class="badge">FastAPI 0.104.1</span>
                <span class="badge">PostgreSQL 15</span>
                <span class="badge">Redis</span>
                <span class="badge">Docker</span>
                <span class="badge">JWT</span>
                <span class="badge">SQLAlchemy</span>
                <span class="badge">Pydantic</span>
            </div>

            <p class="footer-note">
                <i class="fas fa-info-circle"></i>
                La arquitectura est√° dise√±ada para escalabilidad horizontal mediante containerizaci√≥n Docker y comunicaci√≥n por red interna.
            </p>
        </main>
    </div>
</body>
</html>