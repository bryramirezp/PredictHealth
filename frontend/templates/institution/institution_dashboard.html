{% extends "institution/base_institution.html" %}

{% block title %}Dashboard Institucional - PredictHealth{% endblock %}

{% block page_title %}Dashboard Institucional{% endblock %}
{% block page_subtitle %}Vista general de tu institución médica{% endblock %}

{% block current_page %}dashboard{% endblock %}

{% block head_extra %}{% endblock %}

{% block content %}

        <!-- Loading State -->
        <div id="loadingState" class="loading-state" style="display: none;">
            <div class="spinner-container">
                <div class="spinner"></div>
                <p>Cargando datos...</p>
            </div>
        </div>

        <!-- Error State -->
        <div id="errorState" class="error-state" style="display: none;">
            <div class="error-content">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Error de carga</h3>
                <p>No se pudieron cargar los datos. Inténtalo de nuevo.</p>
                <button onclick="loadData()" class="btn btn-primary">Reintentar</button>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboardContent" class="page-content">
            <!-- Welcome Section -->
            <div class="welcome-section">
                <h1 class="welcome-title" id="welcomeTitle">Dashboard Institucional</h1>
                <p class="welcome-subtitle" id="welcomeSubtitle">Vista general de tu institución médica</p>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon doctors">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <div class="stat-menu">
                            <i class="fas fa-ellipsis-h" onclick="showStatMenu('doctors')"></i>
                        </div>
                    </div>
                    <div class="stat-number" id="doctors-count">--</div>
                    <div class="stat-label">Doctores Activos</div>
                    <div class="stat-trend" id="doctors-trend">
                        <i class="fas fa-arrow-up"></i>
                        <span>+2 esta semana</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon patients">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-menu">
                            <i class="fas fa-ellipsis-h" onclick="showStatMenu('patients')"></i>
                        </div>
                    </div>
                    <div class="stat-number" id="patients-count">--</div>
                    <div class="stat-label">Pacientes Totales</div>
                    <div class="stat-trend positive" id="patients-trend">
                        <i class="fas fa-arrow-up"></i>
                        <span>+12 este mes</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon appointments">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-menu">
                            <i class="fas fa-ellipsis-h" onclick="showStatMenu('appointments')"></i>
                        </div>
                    </div>
                    <div class="stat-number" id="appointments-count">--</div>
                    <div class="stat-label">Citas Programadas</div>
                    <div class="stat-trend warning" id="appointments-trend">
                        <i class="fas fa-minus"></i>
                        <span>3 hoy</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon revenue">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                    </div>
                    <div class="stat-number" id="revenue-amount">$--</div>
                    <div class="stat-label">Ingresos Mensuales</div>
                    <div class="stat-trend positive" id="revenue-trend">
                        <i class="fas fa-arrow-up"></i>
                        <span>+8.2%</span>
                    </div>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="main-content">
                <!-- Left Content -->
                <div class="left-content">
                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <h2 class="section-title">
                            <i class="fas fa-bolt"></i>
                            Acciones Rápidas
                        </h2>
                        <div class="actions-grid">
                            <a href="#" onclick="navigateTo('doctors')" class="action-card">
                                <div class="action-icon add-doctor">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Agregar Doctor</h3>
                                    <p>Registrar nuevo profesional médico</p>
                                </div>
                            </a>

                            <a href="#" onclick="navigateTo('patients')" class="action-card">
                                <div class="action-icon view-reports">
                                    <i class="fas fa-user-injured"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Ver Pacientes</h3>
                                    <p>Gestionar registros de pacientes</p>
                                </div>
                            </a>

                            <a href="#" onclick="navigateTo('analytics')" class="action-card">
                                <div class="action-icon analytics">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Estadísticas</h3>
                                    <p>Análisis detallado de rendimiento</p>
                                </div>
                            </a>

                            <a href="#" onclick="createAlert()" class="action-card">
                                <div class="action-icon alert">
                                    <i class="fas fa-bell"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Crear Alerta</h3>
                                    <p>Notificaciones importantes</p>
                                </div>
                            </a>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="recent-activity">
                        <h2 class="section-title">
                            <i class="fas fa-clock"></i>
                            Actividad Reciente
                        </h2>
                        <div class="activity-list" id="activityList">
                            <div class="activity-item">
                                <div class="activity-icon doctor-added">
                                    <i class="fas fa-user-md"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Nuevo doctor registrado</div>
                                    <div class="activity-meta">Dra. María González • Cardiología</div>
                                    <div class="activity-time">Hace 2 horas</div>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="activity-icon patient-care">
                                    <i class="fas fa-stethoscope"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Consulta completada</div>
                                    <div class="activity-meta">5 pacientes atendidos hoy</div>
                                    <div class="activity-time">Hace 4 horas</div>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="activity-icon appointment">
                                    <i class="fas fa-calendar-plus"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Nueva cita programada</div>
                                    <div class="activity-meta">Juan Pérez • Dermatología</div>
                                    <div class="activity-time">Hace 6 horas</div>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="activity-icon report">
                                    <i class="fas fa-file-medical"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Informe mensual generado</div>
                                    <div class="activity-meta">Estadísticas de rendimiento</div>
                                    <div class="activity-time">Hace 1 día</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Scheduler Preview -->
                    <div class="scheduler-preview">
                        <h2 class="section-title">
                            <i class="fas fa-calendar-alt"></i>
                            Agenda del Día
                        </h2>
                        <div class="scheduler-content">
                            <div class="time-slot">
                                <div class="time">09:00</div>
                                <div class="appointment-card">
                                    <div class="appointment-info">
                                        <h4>Dr. Carlos Rodríguez</h4>
                                        <p>Consulta General - Ana López</p>
                                    </div>
                                </div>
                            </div>

                            <div class="time-slot">
                                <div class="time">10:30</div>
                                <div class="appointment-card urgent">
                                    <div class="appointment-info">
                                        <h4>Dra. María González</h4>
                                        <p>Cardiología - Roberto Sánchez</p>
                                    </div>
                                    <div class="appointment-label">
                                        <span class="badge urgent">Urgente</span>
                                    </div>
                                </div>
                            </div>

                            <div class="time-slot">
                                <div class="time">14:00</div>
                                <div class="appointment-card">
                                    <div class="appointment-info">
                                        <h4>Dr. Javier Morales</h4>
                                        <p>Neurología - Carmen Vega</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Content -->
                <div class="right-content">
                    <!-- Institution Health -->
                    <div class="institution-health">
                        <h3 class="section-title">
                            <i class="fas fa-heartbeat"></i>
                            Estado del Sistema
                        </h3>
                        <div class="health-metrics">
                            <div class="health-item">
                                <div class="health-label">Base de Datos</div>
                                <div class="health-status healthy">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Conectado</span>
                                </div>
                            </div>

                            <div class="health-item">
                                <div class="health-label">API Services</div>
                                <div class="health-status healthy">
                                    <i class="fas fa-check-circle"></i>
                                    <span>8/8 Online</span>
                                </div>
                            </div>

                            <div class="health-item">
                                <div class="health-label">Redis Cache</div>
                                <div class="health-status healthy">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Activo</span>
                                </div>
                            </div>

                            <div class="health-item">
                                <div class="health-label">Backup</div>
                                <div class="health-status warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <span>Próximo en 2h</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Weather Widget -->
                    <div class="weather-widget">
                        <h3 class="section-title">
                            <i class="fas fa-cloud-sun"></i>
                            Clima
                        </h3>
                        <div class="weather-content">
                            <div class="weather-main">
                                <div class="weather-icon">
                                    <i class="fas fa-sun"></i>
                                </div>
                                <div class="weather-info">
                                    <div class="temperature">28°C</div>
                                    <div class="condition">Soleado</div>
                                </div>
                            </div>
                            <div class="weather-details">
                                <div class="detail-item">
                                    <span>Humedad:</span>
                                    <span>65%</span>
                                </div>
                                <div class="detail-item">
                                    <span>Viento:</span>
                                    <span>12 km/h</span>
                                </div>
                                <div class="detail-item">
                                    <span>Índice UV:</span>
                                    <span>7 Alto</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications -->
                    <div class="notifications-widget">
                        <h3 class="section-title">
                            <i class="fas fa-bell"></i>
                            Notificaciones
                        </h3>
                        <div class="notifications-list">
                            <div class="notification-item unread">
                                <div class="notification-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="notification-content">
                                    <div class="notification-title">Recordatorio de cita</div>
                                    <div class="notification-message">Juan Pérez - Mañana 10:00 AM</div>
                                    <div class="notification-time">Hace 5 min</div>
                                </div>
                            </div>

                            <div class="notification-item">
                                <div class="notification-icon">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <div class="notification-content">
                                    <div class="notification-title">Nuevo paciente registrado</div>
                                    <div class="notification-message">María Torres - Cardiología</div>
                                    <div class="notification-time">Hace 1 hora</div>
                                </div>
                            </div>

                            <div class="notification-item">
                                <div class="notification-icon">
                                    <i class="fas fa-file-medical"></i>
                                </div>
                                <div class="notification-content">
                                    <div class="notification-title">Resultados disponibles</div>
                                    <div class="notification-message">Laboratorios de Roberto Sánchez</div>
                                    <div class="notification-time">Hace 3 horas</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="quick-stats">
                        <h3 class="section-title">
                            <i class="fas fa-chart-pie"></i>
                            Estadísticas Hoy
                        </h3>
                        <div class="stats-list">
                            <div class="mini-stat">
                                <div class="mini-stat-number">23</div>
                                <div class="mini-stat-label">Citas Completadas</div>
                            </div>

                            <div class="mini-stat">
                                <div class="mini-stat-number">8</div>
                                <div class="mini-stat-label">Nuevos Pacientes</div>
                            </div>

                            <div class="mini-stat">
                                <div class="mini-stat-number">95%</div>
                                <div class="mini-stat-label">Satisfacción</div>
                            </div>

                            <div class="mini-stat">
                                <div class="mini-stat-number">24</div>
                                <div class="mini-stat-label">Doctores Activos</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Floating Action Button -->
    <button class="fab" onclick="showQuickActions()">
        <i class="fas fa-plus"></i>
    </button>

{% endblock %}

{% block scripts_extra %}
<script>
        // Global variables
        let institutionData = {};
        let charts = {};

        // Initialize application
        document.addEventListener('DOMContentLoaded', async function() {
            await loadInstitutionData();
            setupNavigation();
            updateCurrentPage('Dashboard Institucional');
            await loadDashboardData();
        });

        // Setup navigation
        function setupNavigation() {
            // Handle navigation clicks
            document.querySelectorAll('.nav-item a').forEach(link => {
                link.addEventListener('click', function(e) {
                    const href = this.getAttribute('href');
                    if (href && href !== '#') {
                        // Let the browser handle the navigation for actual URLs
                        return;
                    }
                    e.preventDefault();
                    const page = this.closest('.nav-item').dataset.page;
                    navigateTo(page);
                });
            });
        }

        // Navigation function
        function navigateTo(page) {
            // Redirect to actual pages instead of rendering content
            const pageUrls = {
                'doctors': '/institution/doctors',
                'patients': '/institution/patients',
                'analytics': '/institution/analytics',
                'settings': '/institution/settings'
            };

            if (pageUrls[page]) {
                window.location.href = pageUrls[page];
            } else {
                // Stay on dashboard
                currentPage = page;
                updateCurrentPage('Dashboard Institucional');
                loadPageContent(page);
            }
        }

        // Update breadcrumb
        function updateCurrentPage(title) {
            const breadcrumbElement = document.getElementById('currentPage');
            if (breadcrumbElement) {
                breadcrumbElement.textContent = title;
            }
        }

        // Load page content
        function loadPageContent(page) {
            const content = document.getElementById('dashboardContent');

            // Show loading
            showLoadingState();

            // Simulate content loading
            setTimeout(() => {
                switch(page) {
                    case 'dashboard':
                        renderDashboardContent();
                        break;
                    case 'doctors':
                        renderDoctorsContent();
                        break;
                    case 'patients':
                        renderPatientsContent();
                        break;
                    case 'analytics':
                        renderAnalyticsContent();
                        break;
                    case 'settings':
                        renderSettingsContent();
                        break;
                }

                // Hide loading
                hideLoadingState();
            }, 500);
        }

        // Render dashboard content
        function renderDashboardContent() {
            const content = document.getElementById('dashboardContent');

            content.innerHTML = `
                <!-- Welcome Section -->
                <div class="welcome-section">
                    <h1 class="welcome-title">Dashboard Institucional</h1>
                    <p class="welcome-subtitle">Vista general de tu institución médica</p>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon doctors">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <div class="stat-menu">
                                <i class="fas fa-ellipsis-h" onclick="showStatMenu('doctors')"></i>
                            </div>
                        </div>
                        <div class="stat-number" id="doctors-count">--</div>
                        <div class="stat-label">Doctores Activos</div>
                        <div class="stat-trend" id="doctors-trend">
                            <i class="fas fa-arrow-up"></i>
                            <span>+2 esta semana</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon patients">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-menu">
                                <i class="fas fa-ellipsis-h" onclick="showStatMenu('patients')"></i>
                            </div>
                        </div>
                        <div class="stat-number" id="patients-count">--</div>
                        <div class="stat-label">Pacientes Totales</div>
                        <div class="stat-trend positive" id="patients-trend">
                            <i class="fas fa-arrow-up"></i>
                            <span>+12 este mes</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon appointments">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="stat-menu">
                                <i class="fas fa-ellipsis-h" onclick="showStatMenu('appointments')"></i>
                            </div>
                        </div>
                        <div class="stat-number" id="appointments-count">--</div>
                        <div class="stat-label">Citas Programadas</div>
                        <div class="stat-trend warning" id="appointments-trend">
                            <i class="fas fa-minus"></i>
                            <span>3 hoy</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon revenue">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                        </div>
                        <div class="stat-number" id="revenue-amount">$--</div>
                        <div class="stat-label">Ingresos Mensuales</div>
                        <div class="stat-trend positive" id="revenue-trend">
                            <i class="fas fa-arrow-up"></i>
                            <span>+8.2%</span>
                        </div>
                    </div>
                </div>

                <!-- Main Content Grid -->
                <div class="main-content">
                    <!-- Left Content -->
                    <div class="left-content">
                        <!-- Quick Actions -->
                        <div class="quick-actions">
                            <h2 class="section-title">
                                <i class="fas fa-bolt"></i>
                                Acciones Rápidas
                            </h2>
                            <div class="actions-grid">
                                <a href="#" onclick="addNewDoctor()" class="action-card">
                                    <div class="action-icon add-doctor">
                                        <i class="fas fa-user-plus"></i>
                                    </div>
                                    <div class="action-content">
                                        <h3>Agregar Doctor</h3>
                                        <p>Registrar nuevo profesional médico</p>
                                    </div>
                                </a>

                                <a href="#" onclick="scheduleAppointment()" class="action-card">
                                    <div class="action-icon schedule">
                                        <i class="fas fa-calendar-plus"></i>
                                    </div>
                                    <div class="action-content">
                                        <h3>Programar Cita</h3>
                                        <p>Agendar consulta con paciente</p>
                                    </div>
                                </a>

                                <a href="#" onclick="viewReports()" class="action-card">
                                    <div class="action-icon reports">
                                        <i class="fas fa-file-medical"></i>
                                    </div>
                                    <div class="action-content">
                                        <h3>Ver Reportes</h3>
                                        <p>Estadísticas y análisis de datos</p>
                                    </div>
                                </a>

                                <a href="#" onclick="createAlert()" class="action-card">
                                    <div class="action-icon alert">
                                        <i class="fas fa-bell"></i>
                                    </div>
                                    <div class="action-content">
                                        <h3>Crear Alerta</h3>
                                        <p>Notificaciones del sistema</p>
                                    </div>
                                </a>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="recent-activity">
                            <h2 class="section-title">
                                <i class="fas fa-clock"></i>
                                Actividad Reciente
                            </h2>
                            <div class="activity-list" id="activityList">
                                <div class="activity-item">
                                    <div class="activity-icon doctor-added">
                                        <i class="fas fa-user-md"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-title">Nuevo doctor verificado</div>
                                        <div class="activity-meta">Dra. Ana López • Cardiología</div>
                                        <div class="activity-time">Hace 2 horas</div>
                                    </div>
                                </div>

                                <div class="activity-item">
                                    <div class="activity-icon patient-care">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-title">15 pacientes atendidos hoy</div>
                                        <div class="activity-meta">5 especialidades activas</div>
                                        <div class="activity-time">Hace 4 horas</div>
                                    </div>
                                </div>

                                <div class="activity-item">
                                    <div class="activity-icon appointment">
                                        <i class="fas fa-calendar-plus"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-title">8 nuevas citas agendadas</div>
                                        <div class="activity-meta">Para mañana</div>
                                        <div class="activity-time">Hace 6 horas</div>
                                    </div>
                                </div>

                                <div class="activity-item">
                                    <div class="activity-icon report">
                                        <i class="fas fa-file-medical"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-title">Informe semanal generado</div>
                                        <div class="activity-meta">Estadísticas médicas</div>
                                        <div class="activity-time">Hace 1 día</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Content -->
                    <div class="right-content">
                        <!-- Institution Health -->
                        <div class="institution-health">
                            <h3 class="section-title">
                                <i class="fas fa-heartbeat"></i>
                                Estado del Sistema
                            </h3>
                            <div class="health-metrics">
                                <div class="health-item">
                                    <div class="health-label">Base de Datos</div>
                                    <div class="health-status healthy">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Conectado</span>
                                    </div>
                                </div>

                                <div class="health-item">
                                    <div class="health-label">API Services</div>
                                    <div class="health-status healthy">
                                        <i class="fas fa-check-circle"></i>
                                        <span>8/8 Online</span>
                                    </div>
                                </div>

                                <div class="health-item">
                                    <div class="health-label">Redis Cache</div>
                                    <div class="health-status healthy">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Activo</span>
                                    </div>
                                </div>

                                <div class="health-item">
                                    <div class="health-label">Backup</div>
                                    <div class="health-status warning">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <span>Próximo en 2h</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Notifications -->
                        <div class="notifications-widget">
                            <h3 class="section-title">
                                <i class="fas fa-bell"></i>
                                Notificaciones
                            </h3>
                            <div class="notifications-list">
                                <div class="notification-item unread">
                                    <div class="notification-icon urgent">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="notification-content">
                                        <div class="notification-title">Mantenimiento programado</div>
                                        <div class="notification-message">Backup semanal mañana 2:00 AM</div>
                                        <div class="notification-time">Hace 5 min</div>
                                    </div>
                                </div>

                                <div class="notification-item">
                                    <div class="notification-icon info">
                                        <i class="fas fa-info-circle"></i>
                                    </div>
                                    <div class="notification-content">
                                        <div class="notification-title">Nuevo paciente registrado</div>
                                        <div class="notification-message">Roberto Sánchez - Cardiología</div>
                                        <div class="notification-time">Hace 1 hora</div>
                                    </div>
                                </div>

                                <div class="notification-item">
                                    <div class="notification-icon success">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div class="notification-content">
                                        <div class="notification-title">Satisfacción paciente</div>
                                        <div class="notification-message">92% esta semana (+2%)</div>
                                        <div class="notification-time">Hace 3 horas</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render doctors content
        function renderDoctorsContent() {
            const content = document.getElementById('dashboardContent');

            content.innerHTML = `
                <div class="section-header">
                    <div class="section-info">
                        <h1 class="section-title">Gestión de Doctores</h1>
                        <p class="section-subtitle">Administra los profesionales médicos de tu institución</p>
                    </div>
                    <div class="section-actions">
                        <div class="filter-group">
                            <select id="specialtyFilter" class="filter-select">
                                <option value="">Todas las especialidades</option>
                                <option value="cardiologia">Cardiología</option>
                                <option value="dermatologia">Dermatología</option>
                                <option value="neurologia">Neurología</option>
                                <option value="pediatria">Pediatría</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="addNewDoctor()">
                            <i class="fas fa-user-plus me-2"></i>
                            Agregar Doctor
                        </button>
                    </div>
                </div>

                <!-- Doctors Grid -->
                <div class="doctors-grid" id="doctorsGrid">
                    <!-- Doctors will be loaded here -->
                </div>
            `;

            loadDoctors();
        }

        // Render patients content
        function renderPatientsContent() {
            const content = document.getElementById('dashboardContent');

            content.innerHTML = `
                <div class="section-header">
                    <div class="section-info">
                        <h1 class="section-title">Pacientes</h1>
                        <p class="section-subtitle">Gestiona los pacientes de tu institución médica</p>
                    </div>
                    <div class="section-actions">
                        <div class="search-group">
                            <div class="search-input-wrapper">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" id="patientSearch" class="search-input" placeholder="Buscar paciente...">
                            </div>
                        </div>
                        <div class="filter-group">
                            <select id="statusFilter" class="filter-select">
                                <option value="">Todos los estados</option>
                                <option value="active">Activos</option>
                                <option value="inactive">Inactivos</option>
                                <option value="pending">Pendientes</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Patients Stats -->
                <div class="patients-stats">
                    <div class="stat-box">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number" id="totalPatients">--</div>
                            <div class="stat-label">Pacientes Totales</div>
                        </div>
                    </div>

                    <div class="stat-box">
                        <div class="stat-icon positive">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number" id="activePatients">--</div>
                            <div class="stat-label">Pacientes Activos</div>
                        </div>
                    </div>

                    <div class="stat-box">
                        <div class="stat-icon warning">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number" id="pendingReviews">--</div>
                            <div class="stat-label">Pendientes de Revisión</div>
                        </div>
                    </div>

                    <div class="stat-box">
                        <div class="stat-icon urgent">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number" id="highRisk">--</div>
                            <div class="stat-label">Alto Riesgo</div>
                        </div>
                    </div>
                </div>

                <!-- Patients Table -->
                <div class="patients-table">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Paciente</th>
                                    <th>Doctor Asignado</th>
                                    <th>Última Consulta</th>
                                    <th>Estado</th>
                                    <th>Riesgo</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="patientsTableBody">
                                <!-- Patients will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            loadPatientsData();
        }

        // Render analytics content
        function renderAnalyticsContent() {
            const content = document.getElementById('dashboardContent');

            content.innerHTML = `
                <div class="section-header">
                    <div class="section-info">
                        <h1 class="section-title">Analíticas e Informes</h1>
                        <p class="section-subtitle">Estadísticas detalladas y tendencias de tu institución</p>
                    </div>
                    <div class="section-actions">
                        <div class="filter-group">
                            <select id="timeRange" class="filter-select">
                                <option value="7">Última semana</option>
                                <option value="30">Último mes</option>
                                <option value="90">Últimos 3 meses</option>
                                <option value="365">Último año</option>
                            </select>
                            <button class="btn btn-outline-primary" onclick="exportReport()">
                                <i class="fas fa-download me-2"></i>
                                Exportar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Analytics Grid -->
                <div class="analytics-grid">
                    <!-- Appointments Chart -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-calendar-alt"></i>
                                Tendencia de Citas
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="appointmentsChart"></canvas>
                        </div>
                    </div>

                    <!-- Patients by Specialty -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-stethoscope"></i>
                                Pacientes por Especialidad
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="specialtyChart"></canvas>
                        </div>
                    </div>

                    <!-- Revenue Chart -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-dollar-sign"></i>
                                Ingresos Mensuales
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>

                    <!-- Patient Satisfaction -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-smile"></i>
                                Satisfacción Pacientes
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="satisfactionChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- KPIs Section -->
                <div class="kpis-section">
                    <h3 class="section-title">Indicadores Clave de Rendimiento</h3>
                    <div class="kpis-grid">
                        <div class="kpi-item">
                            <div class="kpi-value">96.2%</div>
                            <div class="kpi-label">Tasa de Ocupación</div>
                            <div class="kpi-change positive">+2.1%</div>
                        </div>

                        <div class="kpi-item">
                            <div class="kpi-value">12.5</div>
                            <div class="kpi-label">Días Promedio de Cita</div>
                            <div class="kpi-change negative">-1.3</div>
                        </div>

                        <div class="kpi-item">
                            <div class="kpi-value">$2,450</div>
                            <div class="kpi-label">Ingreso por Paciente</div>
                            <div class="kpi-change positive">+15.2%</div>
                        </div>

                        <div class="kpi-item">
                            <div class="kpi-value">4.8/5</div>
                            <div class="kpi-label">Calificación Promedio</div>
                            <div class="kpi-change positive">+0.2</div>
                        </div>
                    </div>
                </div>
            `;

            loadAnalyticsData();
        }

        // Render settings content
        function renderSettingsContent() {
            const content = document.getElementById('dashboardContent');

            content.innerHTML = `
                <div class="section-header">
                    <div class="section-info">
                        <h1 class="section-title">Configuración de la Institución</h1>
                        <p class="section-subtitle">Administra la configuración y preferencias de tu institución médica</p>
                    </div>
                </div>

                <!-- Settings Grid -->
                <div class="settings-grid">
                    <!-- Institution Info -->
                    <div class="settings-card">
                        <div class="settings-header">
                            <h3>Información de la Institución</h3>
                            <p>Configura los datos básicos de tu institución</p>
                        </div>
                        <div class="settings-content">
                            <form id="institutionForm">
                                <div class="form-group">
                                    <label>Nombre de la Institución</label>
                                    <input type="text" id="institutionName" class="form-control" placeholder="Hospital General">
                                </div>

                                <div class="form-group">
                                    <label>Tipo de Institución</label>
                                    <select id="institutionType" class="form-control">
                                        <option value="hospital">Hospital General</option>
                                        <option value="clinic">Clínica</option>
                                        <option value="specialty">Centro Especializado</option>
                                        <option value="diagnostic">Centro Diagnóstico</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>Dirección</label>
                                    <textarea id="institutionAddress" class="form-control" rows="3"></textarea>
                                </div>

                                <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                            </form>
                        </div>
                    </div>

                    <!-- Working Hours -->
                    <div class="settings-card">
                        <div class="settings-header">
                            <h3>Horarios de Trabajo</h3>
                            <p>Establece los horarios de atención</p>
                        </div>
                        <div class="settings-content">
                            <div class="schedule-grid">
                                <div class="schedule-item">
                                    <div class="day">Lunes - Viernes</div>
                                    <div class="hours">
                                        <input type="time" value="08:00">
                                        <span>a</span>
                                        <input type="time" value="17:00">
                                    </div>
                                </div>

                                <div class="schedule-item">
                                    <div class="day">Sábados</div>
                                    <div class="hours">
                                        <input type="time" value="09:00">
                                        <span>a</span>
                                        <input type="time" value="13:00">
                                    </div>
                                </div>

                                <div class="schedule-item">
                                    <div class="day">Domingos y Festivos</div>
                                    <div class="hours">Cerrado</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Security Settings -->
                    <div class="settings-card">
                        <div class="settings-header">
                            <h3>Configuración de Seguridad</h3>
                            <p>Administra la seguridad y permisos</p>
                        </div>
                        <div class="settings-content">
                            <div class="security-options">
                                <div class="option-item">
                                    <div class="option-info">
                                        <label>Autenticación de 2 factores</label>
                                        <small>Requerir código adicional para iniciar sesión</small>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>

                                <div class="option-item">
                                    <div class="option-info">
                                        <label>Verificación IP</label>
                                        <small>Restringir acceso por ubicación</small>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox">
                                        <span class="slider"></span>
                                    </label>
                                </div>

                                <div class="option-item">
                                    <div class="option-info">
                                        <label>Notificaciones de seguridad</label>
                                        <small>Alertas sobre actividades sospechosas</small>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- System Preferences -->
                    <div class="settings-card">
                        <div class="settings-header">
                            <h3>Preferencias del Sistema</h3>
                            <p>Configura tu experiencia en el sistema</p>
                        </div>
                        <div class="settings-content">
                            <div class="preference-options">
                                <div class="option-item">
                                    <div class="option-info">
                                        <label>Idioma</label>
                                        <small>Selecciona el idioma preferido</small>
                                    </div>
                                    <select class="form-control">
                                        <option value="es">Español</option>
                                        <option value="en">English</option>
                                    </select>
                                </div>

                                <div class="option-item">
                                    <div class="option-info">
                                        <label>Zona horaria</label>
                                        <small>Ajusta la zona horaria local</small>
                                    </div>
                                    <select class="form-control">
                                        <option value="-6">America/Mexico_City (GMT-6)</option>
                                        <option value="-5">America/New_York (GMT-5)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Data loading functions
        async function loadInstitutionData() {
            try {
                const response = await fetch('/api/web/institution/dashboard', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    institutionData = data.data || {};

                    // Update UI with institution data
                    updateInstitutionInfo(institutionData);
                    return data;
                } else if (response.status === 401) {
                    window.location.href = '/institution_login.html';
                    return null;
                } else {
                    console.error('Error loading institution data:', response.status);
                    return null;
                }
            } catch (error) {
                console.error('Error loading institution data:', error);
                return null;
            }
        }

        // Update institution information in UI
        function updateInstitutionInfo(data) {
            if (data.institution) {
                const institutionNameElement = document.getElementById('institutionName');
                if (institutionNameElement) {
                    institutionNameElement.textContent = data.institution.nombre || 'Institución';
                }

                const userNameElement = document.getElementById('userName');
                if (userNameElement) {
                    userNameElement.textContent = data.institution.nombre || 'Institución';
                }

                // Update greeting
                const greetingElement = document.getElementById('institutionGreeting');
                if (greetingElement) {
                    greetingElement.textContent = `Hola, ${data.institution.nombre || 'Institución'}`;
                }
            }
        }

        // Utility functions
        function showLoadingState() {
            const content = document.getElementById('dashboardContent');
            const loading = document.getElementById('loadingState');
            const error = document.getElementById('errorState');

            loading.style.display = 'block';
            error.style.display = 'none';
            content.style.display = 'none';
        }

        function hideLoadingState() {
            const content = document.getElementById('dashboardContent');
            const loading = document.getElementById('loadingState');

            loading.style.display = 'none';
            content.style.display = 'block';
        }

        function showErrorState() {
            const loading = document.getElementById('loadingState');
            const error = document.getElementById('errorState');

            loading.style.display = 'none';
            error.style.display = 'block';
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mainMenu');
            const content = document.getElementById('content');

            menu.classList.toggle('show');
            content.classList.toggle('mobile-menu-open');
        }

        function loadData() {
            // Refresh current page
            loadPageContent(currentPage);
        }

        function refreshData() {
            // Refresh dashboard data
            loadDashboardData();
        }

        // Dummy data loading functions
        async function loadDashboardData() {
            // Simulate API calls with dummy data
            try {
                // Animate counters
                setTimeout(() => {
                    animateNumber('doctors-count', 24);
                }, 500);

                setTimeout(() => {
                    animateNumber('patients-count', 156);
                }, 700);

                setTimeout(() => {
                    animateNumber('appointments-count', 12);
                }, 900);

                setTimeout(() => {
                    document.getElementById('revenue-amount').textContent = '$45,230';
                }, 1100);

            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        function animateNumber(elementId, targetNumber) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const duration = 2000;
            const startTime = performance.now();
            const startNumber = 0;

            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const currentNumber = Math.floor(startNumber + (targetNumber - startNumber) * easeOutQuart);

                element.textContent = currentNumber;

                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }

            requestAnimationFrame(updateNumber);
        }

        function loadDoctors() {
            const doctorsGrid = document.getElementById('doctorsGrid');
            if (!doctorsGrid) return;

            // Dummy doctors data
            const doctors = [
                { name: 'Dra. Ana López', specialty: 'Cardiología', status: 'active', patients: 45 },
                { name: 'Dr. Carlos Rodríguez', specialty: 'Neurología', status: 'active', patients: 28 },
                { name: 'Dra. María González', specialty: 'Dermatología', status: 'active', patients: 32 },
                { name: 'Dr. Javier Morales', specialty: 'Pediatría', status: 'active', patients: 67 },
                { name: 'Dra. Silvia Torres', specialty: 'Ginecología', status: 'active', patients: 39 },
                { name: 'Dr. Roberto Sánchez', specialty: 'Oftalmología', status: 'active', patients: 22 }
            ];

            doctorsGrid.innerHTML = doctors.map(doctor => `
                <div class="doctor-card">
                    <div class="doctor-header">
                        <div class="doctor-avatar">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <div class="doctor-info">
                            <h4>${doctor.name}</h4>
                            <p>${doctor.specialty}</p>
                        </div>
                    </div>
                    <div class="doctor-stats">
                        <div class="stat">
                            <span class="stat-number">${doctor.patients}</span>
                            <span class="stat-label">Pacientes</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">${doctor.status === 'active' ? 'Activo' : 'Inactivo'}</span>
                        </div>
                    </div>
                    <div class="doctor-actions">
                        <button class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye"></i> Ver Perfil
                        </button>
                        <button class="btn btn-sm btn-outline-success">
                            <i class="fas fa-calendar"></i> Citas
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadPatientsData() {
            // Dummy patient stats
            document.getElementById('totalPatients').textContent = '156';
            document.getElementById('activePatients').textContent = '142';
            document.getElementById('pendingReviews').textContent = '8';
            document.getElementById('highRisk').textContent = '12';

            const patientsBody = document.getElementById('patientsTableBody');
            if (!patientsBody) return;

            // Dummy patient data
            const patients = [
                { name: 'Juan Pérez', doctor: 'Dra. Ana López', lastVisit: '2024-01-15', status: 'active', risk: 'low' },
                { name: 'María Torres', doctor: 'Dr. Javier Morales', lastVisit: '2024-01-14', status: 'active', risk: 'medium' },
                { name: 'Carlos Guzmán', doctor: 'Dr. Roberto Sánchez', lastVisit: '2024-01-10', status: 'active', risk: 'high' },
                { name: 'Ana Vargas', doctor: 'Dra. María González', lastVisit: '2024-01-12', status: 'active', risk: 'low' }
            ];

            patientsBody.innerHTML = patients.map(patient => `
                <tr>
                    <td>
                        <div class="patient-info">
                            <div class="patient-avatar">${patient.name.charAt(0)}</div>
                            <div>
                                <div class="fw-semibold">${patient.name}</div>
                            </div>
                        </div>
                    </td>
                    <td>${patient.doctor}</td>
                    <td>${new Date(patient.lastVisit).toLocaleDateString('es-ES')}</td>
                    <td>
                        <span class="badge bg-${patient.status === 'active' ? 'success' : 'secondary'}">
                            ${patient.status === 'active' ? 'Activo' : 'Inactivo'}
                        </span>
                    </td>
                    <td>
                        <span class="badge risk-${patient.risk}">
                            ${patient.risk === 'high' ? 'Alto' : patient.risk === 'medium' ? 'Medio' : 'Bajo'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function loadAnalyticsData() {
            // Initialize sample charts with dummy data
            setTimeout(() => {
                // We'll initialize charts here if Chart.js is available
                console.log('Analytics data loaded');
            }, 1000);
        }

        // Placeholder functions
        function showStatMenu(type) {
            alert(`Menú de estadísticas para ${type} - próximamente disponible`);
        }

        function addNewDoctor() {
            alert('Funcionalidad para agregar doctor próximamente disponible');
        }

        function scheduleAppointment() {
            alert('Funcionalidad para programar cita próximamente disponible');
        }

        function viewReports() {
            alert('Funcionalidad para ver reportes próximamente disponible');
        }

        function createAlert() {
            alert('Funcionalidad para crear alerta próximamente disponible');
        }

        function showQuickActions() {
            alert('Acciones rápidas - próximamente disponible');
        }

        function exportReport() {
            alert('Funcionalidad de exportar reportes próximamente disponible');
        }

        // Logout functionality
        async function handleLogout() {
            if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
                try {
                    const response = await fetch('/auth/logout', {
                        method: 'POST',
                        credentials: 'include'
                    });

                    if (response.ok) {
                        window.location.href = '/';
                    } else {
                        console.error('Logout error:', response.status);
                        alert('Error al cerrar sesión. Inténtalo de nuevo.');
                    }
                } catch (error) {
                    console.error('Logout connection error:', error);
                    alert('Error de conexión. Inténtalo de nuevo.');
                }
            }
        }
</script>
{% endblock %}
