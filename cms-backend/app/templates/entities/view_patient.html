{% extends "base.html" %}

{% block title %}Patient Details - PredictHealth CMS{% endblock %}

{% block page_title %}Patient Details{% endblock %}

{% block page_subtitle %}View detailed information about {{ patient.first_name }} {{ patient.last_name }}{% endblock %}

{% block content %}
<div class="row">
  <div class="col-lg-8">
    <div class="entity-card">
      <div class="entity-header-row">
        <div>
          <h3 class="entity-name">{{ patient.first_name }} {{ patient.last_name }}</h3>
          <p class="entity-specialty">{{ patient.gender.title() if patient.gender else 'Gender not specified' }}</p>
        </div>
        {% if patient.is_active %}
          <span class="badge bg-success">Active</span>
        {% else %}
          <span class="badge bg-secondary">Inactive</span>
        {% endif %}
      </div>

      <div class="entity-meta">
        {% if doctor %}
          <span><i class="bi bi-person me-1"></i>Dr. {{ doctor.first_name }} {{ doctor.last_name }}</span>
        {% endif %}
        {% if institution %}
          <span><i class="bi bi-building me-1"></i>{{ institution.name }}</span>
        {% endif %}
        <span><i class="bi bi-envelope me-1"></i>{{ patient.email }}</span>
        <span><i class="bi bi-telephone me-1"></i>{{ patient.phone }}</span>
      </div>

      <div class="entity-stats">
        <span><i class="bi bi-calendar me-1"></i>Age: {{ ((now().date() - patient.date_of_birth).days // 365) if patient.date_of_birth else 'Unknown' }}</span>
        {% if patient.emergency_contact_name %}
          <span><i class="bi bi-person-lines-fill me-1"></i>Emergency: {{ patient.emergency_contact_name }}</span>
        {% endif %}
        <span><i class="bi bi-calendar-check me-1"></i>Joined: {{ patient.created_at.strftime('%B %d, %Y') if patient.created_at else 'Unknown' }}</span>
      </div>
    </div>

    {% if health_profile %}
    <div class="entity-card">
      <h5>Health Profile</h5>
      <div class="row">
        <div class="col-md-6">
          <div class="entity-meta">
            {% if health_profile.height_cm %}
              <span><i class="bi bi-rulers me-1"></i>Height: {{ health_profile.height_cm }} cm</span>
            {% endif %}
            {% if health_profile.weight_kg %}
              <span><i class="bi bi-speedometer me-1"></i>Weight: {{ health_profile.weight_kg }} kg</span>
            {% endif %}
            {% if health_profile.blood_type %}
              <span><i class="bi bi-droplet me-1"></i>Blood Type: {{ health_profile.blood_type }}</span>
            {% endif %}
          </div>
        </div>
        <div class="col-md-6">
          <div class="entity-meta">
            <span><i class="bi bi-check-circle me-1"></i>Smoker: {{ 'Yes' if health_profile.is_smoker else 'No' }}</span>
            {% if health_profile.consumes_alcohol %}
              <span><i class="bi bi-cup-straw me-1"></i>Alcohol: {{ health_profile.alcohol_frequency.title() }}</span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>

  <div class="col-lg-4">
    <div class="entity-card">
      <h5>Actions</h5>
      <div class="d-grid gap-2">
        <a href="{{ url_for('entities.edit_patient', patient_id=patient.id) }}" class="btn btn-primary">
          <i class="bi bi-pencil me-1"></i>Edit Patient
        </a>
        <form action="{{ url_for('entities.delete_patient', patient_id=patient.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this patient? This action cannot be undone.')">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
          <button type="submit" class="btn btn-danger w-100">
            <i class="bi bi-trash me-1"></i>Delete Patient
          </button>
        </form>
        <hr>
        <a href="{{ url_for('entities.patients') }}" class="btn btn-secondary">
          <i class="bi bi-arrow-left me-1"></i>Back to Patients
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}